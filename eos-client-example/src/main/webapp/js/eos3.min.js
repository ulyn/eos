"use strict";!function(a){"function"==typeof define&&define.amd?define("eos",a):window.eos=a()}(function(){function log(){if(console&&console.log)switch(arguments.length){case 1:console.log(arguments[0]);break;case 2:console.log(arguments[0],arguments[1]);break;case 3:console.log(arguments[0],arguments[1],arguments[2]);break;case 4:console.log(arguments[0],arguments[1],arguments[2],arguments[3]);break;case 5:console.log(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4])}}function noop(){}function ajax(opt){return new Promise(function(resolve,reject){var args,argcount,key,xhr,url=opt.url||"",async=opt.async!==!1,method=opt.type||"GET",data=opt.data||null,dataType=opt.dataType,beforeSend=opt.beforeSend||noop,complete=opt.complete||noop,success=function(a){a.status?resolve(a.result):reject(a.result)},error=function(XMLHttpRequest,textStatus,errorThrown){if(console&&console.info("XMLHttpRequest:",XMLHttpRequest),"parsererror"==textStatus)try{eval("var eval_data="+XMLHttpRequest.responseText),eval_data.status?resolve(eval_data.result,eval_data.status):reject(eval_data.result)}catch(e){reject("解析返回数据异常！")}else reject(textStatus)};if(data){if(args="","string"==typeof data)args=data;else if("object"==typeof data){argcount=0;for(key in data)if(data.hasOwnProperty(key)){if(null==data[key])continue;argcount++&&(args+="&"),args+=encodeURIComponent(key)+"="+encodeURIComponent(data[key])}}method=method.toUpperCase(),"GET"==method?(url+=(-1==url.indexOf("?")?"?":"&")+args,data=null):data=args}return xhr=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),beforeSend(xhr),xhr.onreadystatechange=function(){var a,b;4==xhr.readyState&&(a=xhr.status,a>=200&&300>a?(b=xhr.responseText,"json"==dataType&&b?success(JSON.parse(b)):success(b)):error(xhr,a),complete(a,xhr))},xhr.open(method,url,async),"POST"==method&&xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded;"),xhr.send(data),xhr})}function extend(a){var c,d,e,b=arguments.length;if(2>b||null==a)return a;for(c=1;b>c;c++){d=arguments[c];for(e in d)null!=d[e]&&""!==d[e]&&(a[e]=d[e])}return a}function getContextPath(a){var c,d,e,b=document.getElementsByTagName("script");if(b&&b.length>0){for(c=0;c<b.length;c++)if(d=b[c],e=d.hasAttribute?d.src:d.getAttribute("src",4),-1!==e.indexOf(a))return e.substring(0,e.indexOf(a));return log("【eos温馨提示】截取上下文URL有误，baseUrl不正确，请确认已经重新设置eos remote url，如：eos.rewriteUrl('remote');"),"ERROR:BASEURL_UNKNOWN"}return""}function guessMock(a,b,c){return c?c:a&&"string"==typeof a?a:b&&"string"==typeof b?b:""}function guessSuccess(a){return a&&"function"==typeof a?a:null}function guessError(a,b){return b&&"function"==typeof b?b:null}function isArray(a){return"[object Array]"===Object.prototype.toString.call(a)}function eosPromise(a){var c,d,e,f,b=extend({},instance.defaultSettings,a);if(b.url||(instance.rewriteUrl(getContextPath("/static")+"/remote"),b.url=instance.defaultSettings.url),c="eos_appid="+b.appId+"&eos_service_id="+b.serviceId+"&eos_method_name="+b.method+"&eos_version="+b.version+"&eos_mock="+(null==b.mock?"":b.mock),b.url=-1!=b.url.indexOf("?")?b.url+"&"+c:b.url+"?"+c,d=b.data,null!=d&&"object"==typeof d)for(e in d)null!=d[e]&&"object"==typeof d[e]&&(d[e]=JSON.stringify(d[e]));return f=ajax({type:"post",url:b.url+"&r="+Math.random(),dataType:b.dataType,data:d,async:b.async,beforeSend:b.beforeSend,complete:b.complete}),b.success?(f.then(b.success,b.error),void 0):f}function Service(a,b){this.appId=a,this.serviceId=b}function Eos(){}var PENDING,FULFILLED,REJECTED,isFunction,isArray,isThenable,transition,publish,instance,Promise=window.Promise;return Promise||(PENDING=void 0,FULFILLED=1,REJECTED=2,isFunction=function(a){return"function"==typeof a},isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},isThenable=function(a){return a&&"function"==typeof a["then"]},transition=function(a,b){var c=this;c._status===PENDING&&setTimeout(function(){c._status=a,publish.call(c,b)})},publish=function(a){for(var c,b=this,d=b._status===FULFILLED,e=b[d?"_resolves":"_rejects"];c=e.shift();)a=c.call(b,a)||a;b[d?"_value":"_reason"]=a,b["_resolves"]=b["_rejects"]=void 0},Promise=function(a){var b,c,d;if(!isFunction(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");return this instanceof Promise?(b=this,b._value,b._reason,b._status=PENDING,b._resolves=[],b._rejects=[],c=function(a){transition.apply(b,[FULFILLED].concat([a]))},d=function(a){transition.apply(b,[REJECTED].concat([a]))},a(c,d),void 0):new Promise(a)},Promise.prototype.then=function(a,b){var c=this;return Promise(function(d,e){function f(b){var c=isFunction(a)&&a(b)||b;isThenable(c)?c.then(function(a){d(a)},function(a){e(a)}):d(c)}function g(a){a=isFunction(b)&&b(a)||a,e(a)}c._status===PENDING?(c._resolves.push(f),c._rejects.push(g)):c._status===FULFILLED?f(c._value):c._status===REJECTED&&g(c._reason)})},Promise.prototype["catch"]=function(a){return this.then(void 0,a)},Promise.prototype.delay=function(a){return this.then(function(b){return Promise.delay(a,b)})},Promise.delay=function(a,b){return Promise(function(c){setTimeout(function(){c(b)},a)})},Promise.resolve=function(a){return Promise(function(b){b(a)})},Promise.reject=function(a){return Promise(function(b,c){c(a)})},Promise.all=function(a){if(!isArray(a))throw new TypeError("You must pass an array to all.");return Promise(function(b,c){function g(a){return function(b){i(a,b)}}function h(a){c(a)}function i(a,c){e[a]=c,a==f-1&&b(e)}for(var d=0,e=[],f=a.length;f>d;d++)a[d].then(g(d),h)})},Promise.race=function(a){if(!isArray(a))throw new TypeError("You must pass an array to race.");return Promise(function(b,c){function f(a){b(a)}function g(a){c(a)}for(var d=0,e=a.length;e>d;d++)a[d].then(f,g)})}),Service.prototype.registerMethod=function(a,b,c){if(isArray(c)){var d=this;if(d[a])throw new Error("【eos】服务方法已经注册，请不要重复注册："+d.appId+"-"+d.serviceId+"-"+a);return d[a]=function(){var f,g,h,i,e={};for(f=0;f<c.length;f++)e[c[f]]=arguments[f];return g=arguments[c.length],h=arguments[c.length+1],i=arguments[c.length+2],eosPromise({appId:d.appId,serviceId:d.serviceId,method:a,version:b,mock:guessMock(g,h,i),data:e,success:guessSuccess(g,h,i),error:guessError(g,h,i)})},d}throw new Error("【eos】注册方法错误，入参不正确！paramNames 必须为数组方式："+c)},Eos.prototype.version=3,Eos.prototype.defaultSettings={dataType:"json",url:"",appId:"",serviceId:"",method:"",version:"",mock:"",data:null,async:!0,beforeSend:null,complete:null,success:null,error:null},Eos.prototype.rewriteUrl=function(a){this.defaultSettings.url=a},Eos.prototype.registerService=function(a,b){var c,d,e;if(this[a]&&!this.hasOwnProperty(a)){c=[];for(d in this)this.hasOwnProperty(a)||c.push(d);throw new Error("【eos】不允许使用关键字["+c.join(",")+"]作为应用id["+a+"]，请更换!")}if(e=this[a]=this[a]||{},e[b])throw new Error("【eos】不允许重复注册服务["+a+"-"+b+"]，请统一一处注册");return e[b]=new Service(a,b)},Eos.prototype.utils={getContextPath:getContextPath,extend:extend,isArray:isArray,guessMock:guessMock,guessSuccess:guessSuccess,guessError:guessError},Eos.prototype.Promise=Promise,instance=window.eos=new Eos});